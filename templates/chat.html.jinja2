<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">

    <title>Chat App</title>
    <style>
      .chat-item {
        margin-bottom: 10px;
      }

      .feedback {
        white-space: pre-wrap;
      }

      label {
        display: block;
        margin-bottom: 5px;
      }

      input[type="text"], textarea {
        display: block;
        width: 52ch;
      }

      /* Add the following styles to change the background color of the message textarea when the form is submitting. */
      #message.submitting {
        background-color: #ccc;
      }
    </style>
  </head>

  <body>
    <h1>Chat History</h1>
    <form action="{{ url_for('forget') }}" method="POST">
      <input type="submit" value="Âà†Èô§ËÆ∞ÂøÜ">
    </form>

    <div id="chat-history">
      {% for message, feedback in chat_history %}
      <div class="chat-item">
        <div>üò≥ {{ message }}</div>
        <div class="feedback">üñ•Ô∏è {{ feedback }}</div>
      </div>
      {% endfor %}
    </div>
    <h2>Send a Message</h2>
    <form id="chat-form" action="{{ url_for('chat') }}" method="post">
      <label for="message">Message:</label>
      <textarea id="message" name="message" rows="4"></textarea>
      <label for="token">Token:</label>
      <input type="text" id="token" name="token">
      <input type="submit" value="Send" id="submit-button">
    </form>
    <script>
      // Retrieve the saved token value from local storage and set it as the value of the token input.
      const savedToken = localStorage.getItem("token");
      if (savedToken) {
        document.getElementById("token").value = savedToken;
      }

      // Handle form submission when Shift + Enter is pressed in the message textarea.
      document.getElementById("message").addEventListener("keydown", function(event) {
        if (event.shiftKey && event.keyCode === 13) {
          event.preventDefault();
          document.getElementById("submit-button").disabled = true;
          document.getElementById("message").classList.add("submitting"); // Add the "submitting" class to the message textarea.
          document.getElementById("chat-form").submit();
        }
      });

      // Save the token value to local storage whenever it changes.
      document.getElementById("token").addEventListener("input", function(event) {
        localStorage.setItem("token", event.target.value);
      });

      // Add an event listener for the "submit" event of the form.
      document.getElementById("chat-form").addEventListener("submit", function() {
        document.getElementById("message").classList.remove("submitting"); // Remove the "submitting" class from the message textarea.
      });
    </script>
  </body>

</html>
